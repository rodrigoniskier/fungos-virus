<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Slides Epidemiol√≥gicos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
        }
        .step-card {
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .progress-bar-fill {
            transition: width 0.4s ease-in-out;
        }
        .infection-btn {
            transition: all 0.2s ease-in-out;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .infection-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: #4ECDC4;
        }
        .infection-btn.selected {
            background-color: #4ECDC4;
            color: #1A535C;
            border-color: #4ECDC4;
            font-weight: 600;
        }
        .variable-btn {
            transition: all 0.2s ease-in-out;
        }
        .variable-btn.active {
            background-color: #4ECDC4 !important;
            color: #1A535C !important;
            font-weight: 600;
        }
        .data-input-cell {
            padding: 8px;
            border: 1px solid #4a5568;
            min-width: 80px;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="container mx-auto max-w-5xl">
        <div id="app" class="bg-gray-800 rounded-xl shadow-2xl overflow-hidden border border-gray-700" style="background: linear-gradient(145deg, #2d3748, #1a202c);">
            
            <div class="p-6 border-b border-gray-700">
                <h1 class="text-3xl font-bold text-gray-100 text-center mb-4">Gerador de Apresenta√ß√£o Epidemiol√≥gica</h1>
                <div class="w-full bg-gray-700 rounded-full h-3">
                    <div id="progressBar" class="h-3 rounded-full progress-bar-fill" style="width: 25%; background: linear-gradient(90deg, #4ECDC4, #F7B801);"></div>
                </div>
                 <p id="step-indicator" class="text-center text-sm text-gray-400 mt-2">Passo 1 de 4</p>
            </div>

            <div id="steps-container" class="p-8">
                <!-- Passo 1: Sele√ß√£o da Infec√ß√£o -->
                <div id="step-1" class="step-card">
                    <h2 class="text-2xl font-semibold mb-6 text-gray-200">1. Escolha a Infec√ß√£o para An√°lise</h2>
                    <div id="infection-list" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Op√ß√µes de infec√ß√£o -->
                    </div>
                </div>

                <!-- Passo 2: Simula√ß√£o de Digita√ß√£o -->
                <div id="step-2" class="step-card hidden">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-200">2. Simula√ß√£o de Entrada de Dados</h2>
                    <p class="text-gray-400 mb-4">A tabela abaixo est√° vazia. Para simular a entrada, voc√™ pode preencher os campos. Clique em "Pr√≥xima" para continuar (os dados pr√©-compilados ser√£o usados).</p>
                    <div class="h-80 overflow-auto border border-gray-600 rounded-lg p-2 bg-gray-900/50">
                        <table id="data-table" class="min-w-full text-sm text-left">
                            <thead class="bg-gray-700 sticky top-0"></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <!-- Passo 3: An√°lise Interativa -->
                <div id="step-3" class="step-card hidden">
                    <h2 class="text-2xl font-semibold mb-4 text-gray-200">3. An√°lise de Dados e Gr√°ficos</h2>
                    <p class="text-gray-400 mb-6">Selecione uma vari√°vel na lista √† esquerda para visualizar o gr√°fico correspondente √† direita.</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 min-h-[400px]">
                        <div id="variable-buttons" class="flex flex-col gap-2 overflow-y-auto max-h-[400px] pr-2">
                            <!-- Bot√µes das vari√°veis -->
                        </div>
                        <div class="md:col-span-2 bg-gray-900/50 p-4 rounded-lg border border-gray-700 flex items-center justify-center">
                            <canvas id="variableChart"></canvas>
                        </div>
                    </div>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-8">
                        <div>
                            <label for="observations" class="block mb-2 text-sm font-medium text-gray-300">Observa√ß√µes sobre os Dados (um t√≥pico por linha):</label>
                            <textarea id="observations" rows="4" class="block p-2.5 w-full text-sm bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-cyan-500 focus:border-cyan-500" placeholder="Ex: A maioria dos pacientes era do sexo feminino.&#10;A febre foi um sintoma universal.&#10;..."></textarea>
                        </div>
                        <div>
                            <label for="conclusion" class="block mb-2 text-sm font-medium text-gray-300">Conclus√£o Epidemiol√≥gica (um t√≥pico por linha):</label>
                            <textarea id="conclusion" rows="4" class="block p-2.5 w-full text-sm bg-gray-700 text-white rounded-lg border border-gray-600 focus:ring-cyan-500 focus:border-cyan-500" placeholder="Digite sua conclus√£o aqui..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Passo 4: Layout e Finaliza√ß√£o -->
                <div id="step-4" class="step-card hidden">
                    <h2 class="text-2xl font-semibold mb-6 text-gray-200">4. Finalizar Apresenta√ß√£o</h2>
                    <div class="mb-6">
                        <label class="block mb-2 text-sm font-medium text-gray-300">Escolha um Layout (Cor do Tema):</label>
                        <div id="layout-options" class="flex flex-wrap gap-4">
                            <!-- Op√ß√µes de Layout -->
                        </div>
                    </div>
                    <div>
                        <label for="authors" class="block mb-2 text-sm font-medium text-gray-300">Respons√°veis pelo Relat√≥rio:</label>
                        <input type="text" id="authors" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-cyan-500 focus:border-cyan-500 block w-full p-2.5" placeholder="Ex: Jo√£o da Silva, Maria Oliveira">
                    </div>
                </div>
            </div>

            <!-- Navega√ß√£o -->
            <div class="flex justify-between p-6 bg-gray-900/50 border-t border-gray-700">
                <button id="prev-btn" class="py-2 px-5 rounded-lg text-white font-semibold bg-gray-600 hover:bg-gray-500 disabled:bg-gray-700 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors">Anterior</button>
                <button id="next-btn" class="py-2 px-5 rounded-lg text-gray-900 font-semibold bg-cyan-400 hover:bg-cyan-300 disabled:bg-cyan-800 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors">Pr√≥xima</button>
                <button id="generate-btn" class="py-2 px-5 rounded-lg text-white font-semibold bg-green-500 hover:bg-green-400 hidden disabled:bg-green-800 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors">Gerar Apresenta√ß√£o</button>
            </div>
        </div>
    </div>

<script>
const state = {
    currentStep: 1,
    selectedInfection: null,
    analysis: {
        observations: '',
        conclusion: ''
    },
    presentation: {
        layout: 'teal',
        authors: ''
    },
    data: {},
    charts: {},
    chartTypeIndex: 0
};

const infectionData = {
    'Dengue': {
        rawData: `Paciente,Sexo,Idade,Febre alta s√∫bita,Cefaleia intensa,Mialgia/artralgia,Exantema,Dor retro-orbit√°ria,Plaquetas <100.000,Hemoconcentra√ß√£o (Ht ‚Üë),Dor abdominal intensa,Sangramento,Sorologia NS1/IgM positiva
1,F,22,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
2,M,35,Sim,Sim,Sim,N√£o,Sim,Sim,Sim,N√£o,Sim,Sim
3,F,28,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,N√£o,N√£o,Sim
4,M,41,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
5,F,19,Sim,Sim,Sim,N√£o,Sim,N√£o,N√£o,N√£o,N√£o,Sim
6,M,56,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
7,F,33,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,N√£o,N√£o,Sim
8,M,27,Sim,Sim,Sim,N√£o,Sim,N√£o,N√£o,N√£o,N√£o,Sim
9,F,48,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,N√£o,Sim
10,M,52,Sim,Sim,Sim,N√£o,Sim,Sim,Sim,Sim,Sim,Sim
11,F,30,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,N√£o,N√£o,Sim
12,M,44,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
13,F,25,Sim,Sim,Sim,N√£o,Sim,N√£o,N√£o,N√£o,N√£o,Sim
14,M,39,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
15,F,21,Sim,Sim,Sim,N√£o,Sim,N√£o,N√£o,N√£o,N√£o,Sim
16,M,47,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,N√£o,Sim
17,F,34,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
18,M,50,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
19,F,29,Sim,Sim,Sim,N√£o,Sim,N√£o,N√£o,N√£o,N√£o,Sim
20,M,61,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim`,
        info: {
            introduction: `<ul><li><span class="icon">ü¶ü</span><strong>Agente e Vetor:</strong> A dengue √© uma arbovirose causada pelo v√≠rus da Dengue (DENV), um Flavivirus, transmitido principalmente pela picada da f√™mea do mosquito <em>Aedes aegypti</em>.</li><li><span class="icon">üî¢</span><strong>Complexidade Sorot√≠pica:</strong> Existem quatro sorotipos distintos (DENV-1, 2, 3 e 4). A infec√ß√£o por um sorotipo confere imunidade permanente contra ele, mas apenas prote√ß√£o tempor√°ria e parcial contra os outros.</li><li><span class="icon">üìú</span><strong>Material Gen√©tico:</strong> O genoma viral √© constitu√≠do por RNA de fita simples e sentido positivo, que codifica tr√™s prote√≠nas estruturais e sete n√£o estruturais, essenciais para a replica√ß√£o e patog√™nese.</li></ul>`,
            medicalImportance: `<ul><li><span class="icon">üåç</span><strong>Problema de Sa√∫de Global:</strong> A OMS estima que centenas de milh√µes de infec√ß√µes ocorram anualmente, colocando quase metade da popula√ß√£o mundial em risco, especialmente em √°reas tropicais e subtropicais.</li><li><span class="icon">üå°Ô∏è</span><strong>Espectro Cl√≠nico Amplo:</strong> A doen√ßa varia desde formas assintom√°ticas ou leves (Dengue Cl√°ssica) at√© quadros graves com extravasamento de plasma, hemorragias e choque (Dengue Grave), podendo levar √† morte.</li><li><span class="icon">‚ö†Ô∏è</span><strong>Infec√ß√£o Sequencial:</strong> A principal teoria para a ocorr√™ncia de casos graves √© a infec√ß√£o secund√°ria por um sorotipo diferente, atrav√©s do mecanismo de Amplifica√ß√£o Dependente de Anticorpos (ADE), que exacerba a resposta imune.</li></ul>`,
            clinicalPerspective: `<ul><li><span class="icon">üíß</span><strong>Manejo Cl√≠nico:</strong> Focado no suporte h√≠drico e reconhecimento precoce dos sinais de alarme.</li><li><span class="icon">üö´</span><strong>Controle Epidemiol√≥gico:</strong> Baseado no combate ao vetor <em>Aedes aegypti</em> e na vigil√¢ncia ativa.</li><li><span class="icon">üíâ</span><strong>Preven√ß√£o:</strong> Vacinas j√° est√£o dispon√≠veis e s√£o uma ferramenta importante para o controle.</li></ul>`
        }
    },
    'Herpes': {
        rawData: `Paciente,Sexo,Idade,Tipo cl√≠nico,Les√µes vesiculares dolorosas,Localiza√ß√£o (oral/genital),Recorr√™ncia,Febre,HIV+,PCR positivo para HSV
1,F,23,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
2,M,31,HSV-1,Sim,Oral,Sim,N√£o,N√£o,Sim
3,F,27,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
4,M,35,HSV-1,Sim,Oral,N√£o,Sim,N√£o,Sim
5,F,29,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
6,M,42,HSV-1,Sim,Oral,Sim,N√£o,N√£o,Sim
7,F,26,HSV-2,Sim,Genital,N√£o,Sim,N√£o,Sim
8,M,38,HSV-1,Sim,Oral,Sim,N√£o,N√£o,Sim
9,F,33,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
10,M,45,HSV-1,Sim,Oral,N√£o,Sim,N√£o,Sim
11,F,21,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
12,M,36,HSV-1,Sim,Oral,Sim,N√£o,N√£o,Sim
13,F,40,HSV-2,Sim,Genital,N√£o,Sim,N√£o,Sim
14,M,28,HSV-1,Sim,Oral,Sim,N√£o,N√£o,Sim
15,F,25,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
16,M,49,HSV-1,Sim,Oral,Sim,Sim,Sim,Sim
17,F,32,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
18,M,53,HSV-1,Sim,Oral,N√£o,Sim,Sim,Sim
19,F,30,HSV-2,Sim,Genital,Sim,N√£o,N√£o,Sim
20,M,41,HSV-1,Sim,Oral,Sim,N√£o,Sim,Sim`,
        info: {
            introduction: `<ul><li><span class="icon">üß¨</span><strong>Agente Etiol√≥gico:</strong> Infec√ß√£o causada pelo V√≠rus Herpes Simples (HSV), um v√≠rus de DNA da fam√≠lia Herpesviridae. Existem dois tipos principais: HSV-1, associado classicamente a les√µes orais, e HSV-2, a les√µes genitais.</li><li><span class="icon">üîÑ</span><strong>Ciclo de Infec√ß√£o:</strong> A caracter√≠stica marcante do HSV √© sua capacidade de estabelecer uma infec√ß√£o latente em g√¢nglios neurais ap√≥s a infec√ß√£o prim√°ria. O v√≠rus pode ser reativado periodicamente, causando les√µes recorrentes.</li><li><span class="icon">ü§ù</span><strong>Transmiss√£o:</strong> Ocorre por contato direto com as les√µes vesiculares ou com secre√ß√µes contaminadas (saliva, secre√ß√µes genitais), mesmo na aus√™ncia de les√µes vis√≠veis (dissemina√ß√£o assintom√°tica).</li></ul>`,
            medicalImportance: `<ul><li><span class="icon">üåç</span><strong>Alta Preval√™ncia:</strong> As infec√ß√µes por HSV est√£o entre as mais comuns na popula√ß√£o mundial. A OMS estima que bilh√µes de pessoas vivam com HSV-1 ou HSV-2.</li><li><span class="icon">üß†</span><strong>Complica√ß√µes Graves:</strong> Embora geralmente cause les√µes mucocut√¢neas benignas, o HSV pode levar a complica√ß√µes s√©rias, como ceratite herp√©tica (infec√ß√£o da c√≥rnea), herpes neonatal (infec√ß√£o grave no rec√©m-nascido) e encefalite herp√©tica, a causa mais comum de encefalite viral espor√°dica fatal.</li><li><span class="icon">üë•</span><strong>Impacto em Imunocomprometidos:</strong> Em indiv√≠duos com sistema imune debilitado (ex: HIV/AIDS, transplantados), as infec√ß√µes por HSV podem ser mais frequentes, extensas, at√≠picas e graves, com maior risco de dissemina√ß√£o visceral.</li></ul>`,
            clinicalPerspective: `<ul><li><span class="icon">üíä</span><strong>Tratamento:</strong> Antivirais (ex: Aciclovir) reduzem a dura√ß√£o e a gravidade dos surtos, mas n√£o curam a infec√ß√£o.</li><li><span class="icon">üõ°Ô∏è</span><strong>Preven√ß√£o:</strong> Focada na educa√ß√£o sobre transmiss√£o e pr√°ticas sexuais seguras.</li><li><span class="icon">üë•</span><strong>Popula√ß√µes de Risco:</strong> Pacientes imunocomprometidos podem apresentar quadros mais graves.</li></ul>`
        }
    },
    'Hepatite B': {
        rawData: `Paciente,Sexo,Idade,Forma cl√≠nica,Icter√≠cia,Astenia,Dor abdominal,N√°useas,HBsAg,Anti-HBc IgM,Anti-HBc total,HBeAg,Carga viral detect√°vel,ALT elevada
1,M,32,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim
2,F,41,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
3,M,55,Cr√¥nica,N√£o,Sim,Sim,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
4,F,27,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim
5,M,63,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
6,F,36,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
7,M,44,Cr√¥nica,N√£o,Sim,Sim,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
8,F,50,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
9,M,39,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim
10,F,29,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim
11,M,58,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
12,F,35,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
13,M,46,Cr√¥nica,N√£o,Sim,Sim,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
14,F,40,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
15,M,60,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
16,F,34,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim
17,M,49,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
18,F,38,Cr√¥nica,N√£o,Sim,Sim,N√£o,Pos,Neg,Pos,Neg,Baixa,Leve
19,M,54,Cr√¥nica,N√£o,Sim,N√£o,N√£o,Pos,Neg,Pos,Neg,Alta,Sim
20,F,31,Aguda,Sim,Sim,Sim,Sim,Pos,Pos,Pos,Pos,Alta,Sim`,
        info: {
            introduction: `<ul><li><span class="icon">üß¨</span><strong>Agente Etiol√≥gico:</strong> O v√≠rus da Hepatite B (HBV) √© um v√≠rus de DNA da fam√≠lia Hepadnaviridae, que infecta primariamente os hepat√≥citos.</li><li><span class="icon">ü©∏</span><strong>Formas de Transmiss√£o:</strong> A transmiss√£o ocorre pelo contato com sangue ou fluidos corporais infectados, principalmente por via sexual, parenteral (compartilhamento de agulhas, transfus√µes) e vertical (de m√£e para filho durante o parto).</li><li><span class="icon">‚è≥</span><strong>Evolu√ß√£o da Infec√ß√£o:</strong> A infec√ß√£o pode ser aguda e autolimitada (resolvida pelo sistema imune) ou evoluir para uma infec√ß√£o cr√¥nica, que persiste por toda a vida se n√£o tratada.</li></ul>`,
            medicalImportance: `<ul><li><span class="icon">ü©∫</span><strong>Principal Causa de Doen√ßa Hep√°tica:</strong> A infec√ß√£o cr√¥nica pelo HBV √© uma das principais causas de doen√ßa hep√°tica cr√¥nica no mundo, sendo respons√°vel por uma alta propor√ß√£o dos casos de cirrose e carcinoma hepatocelular (c√¢ncer de f√≠gado).</li><li><span class="icon">üåç</span><strong>Endemicidade:</strong> A doen√ßa √© um grave problema de sa√∫de p√∫blica, com mais de 250 milh√µes de pessoas vivendo com a infec√ß√£o cr√¥nica globalmente, resultando em quase 1 milh√£o de mortes anuais.</li><li><span class="icon">üíâ</span><strong>Preven√ß√£o Eficaz:</strong> A exist√™ncia de uma vacina segura e altamente eficaz torna a hepatite B uma doen√ßa preven√≠vel. A vacina√ß√£o universal de rec√©m-nascidos √© a estrat√©gia mais importante para o controle da doen√ßa.</li></ul>`,
            clinicalPerspective: `<ul><li><span class="icon">üíâ</span><strong>Preven√ß√£o:</strong> A vacina√ß√£o √© a medida mais eficaz e segura para prevenir a infec√ß√£o.</li><li><span class="icon">üíä</span><strong>Tratamento:</strong> Para a forma cr√¥nica, visa suprimir a replica√ß√£o viral e prevenir a progress√£o da doen√ßa.</li><li><span class="icon">üî¨</span><strong>Diagn√≥stico:</strong> Realizado por meio de marcadores sorol√≥gicos que definem o est√°gio da infec√ß√£o.</li></ul>`
        }
    },
    'Influenza': {
        rawData: `Paciente,Sexo,Idade,Febre,Tosse seca,Odinofagia,Mialgia,Cefaleia,Dispneia,Comorbidade (HAS/DM/Asma),Hospitaliza√ß√£o,RT-PCR positivo
1,F,24,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
2,M,37,Sim,Sim,N√£o,Sim,Sim,N√£o,N√£o,N√£o,Sim
3,F,58,Sim,Sim,Sim,Sim,Sim,Sim,HAS,Sim,Sim
4,M,19,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
5,F,43,Sim,Sim,N√£o,Sim,Sim,N√£o,DM,N√£o,Sim
6,M,62,Sim,Sim,Sim,Sim,Sim,Sim,HAS,Sim,Sim
7,F,29,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
8,M,46,Sim,Sim,Sim,Sim,Sim,N√£o,Asma,N√£o,Sim
9,F,33,Sim,Sim,N√£o,Sim,Sim,N√£o,N√£o,N√£o,Sim
10,M,71,Sim,Sim,Sim,Sim,Sim,Sim,HAS/DM,Sim,Sim
11,F,40,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
12,M,55,Sim,Sim,N√£o,Sim,Sim,Sim,HAS,Sim,Sim
13,F,27,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
14,M,64,Sim,Sim,Sim,Sim,Sim,Sim,HAS,Sim,Sim
15,F,36,Sim,Sim,N√£o,Sim,Sim,N√£o,N√£o,N√£o,Sim
16,M,42,Sim,Sim,Sim,Sim,Sim,N√£o,Asma,N√£o,Sim
17,F,31,Sim,Sim,Sim,Sim,Sim,N√£o,N√£o,N√£o,Sim
18,M,68,Sim,Sim,Sim,Sim,Sim,Sim,DM,Sim,Sim
19,F,50,Sim,Sim,N√£o,Sim,Sim,N√£o,HAS,N√£o,Sim
20,M,74,Sim,Sim,Sim,Sim,Sim,Sim,HAS/DM,Sim,Sim`,
        info: {
            introduction: `<ul><li><span class="icon">ü¶†</span><strong>Agente Etiol√≥gico:</strong> O v√≠rus Influenza, da fam√≠lia Orthomyxoviridae, √© o causador da gripe, uma infec√ß√£o respirat√≥ria aguda.</li><li><span class="icon">üìú</span><strong>Genoma Segmentado:</strong> Seu genoma de RNA √© dividido em 8 segmentos, o que confere ao v√≠rus uma alta capacidade de muta√ß√£o (<em>antigenic drift</em>) e rearranjo gen√©tico (<em>antigenic shift</em>).</li><li><span class="icon"> Proteins de Superf√≠cie:</span> As principais prote√≠nas de superf√≠cie s√£o a Hemaglutinina (HA), que se liga √†s c√©lulas hospedeiras, e a Neuraminidase (NA), que libera novas part√≠culas virais. Elas definem os subtipos virais (ex: H1N1, H3N2).</li></ul>`,
            medicalImportance: `<ul><li><span class="icon">üçÇ</span><strong>Impacto Sazonal:</strong> A gripe causa epidemias anuais que resultam em milh√µes de casos, centenas de milhares de hospitaliza√ß√µes e dezenas de milhares de mortes em todo o mundo, sobrecarregando os sistemas de sa√∫de.</li><li><span class="icon">üåç</span><strong>Potencial Pand√™mico:</strong> O rearranjo gen√©tico (<em>shift</em>) entre v√≠rus de influenza de diferentes esp√©cies (ex: avi√°ria, su√≠na) pode criar um subtipo viral completamente novo, contra o qual a popula√ß√£o n√£o tem imunidade, podendo desencadear uma pandemia com alta mortalidade.</li><li><span class="icon">üë•</span><strong>Grupos de Alto Risco:</strong> A infec√ß√£o √© particularmente perigosa para idosos, crian√ßas muito pequenas, gestantes e indiv√≠duos com doen√ßas cr√¥nicas (card√≠acas, pulmonares, diabetes), que t√™m maior risco de desenvolver complica√ß√µes graves como a pneumonia.</li></ul>`,
            clinicalPerspective: `<ul><li><span class="icon">üíâ</span><strong>Preven√ß√£o:</strong> A vacina√ß√£o anual √© a principal estrat√©gia de controle.</li><li><span class="icon">üíä</span><strong>Tratamento:</strong> Antivirais podem ser usados, principalmente em casos graves.</li><li><span class="icon">üì°</span><strong>Vigil√¢ncia:</strong> A vigil√¢ncia global √© fundamental para monitorar a evolu√ß√£o do v√≠rus.</li></ul>`
        }
    },
    'Candid√≠ase': {
        rawData: `Paciente,Sexo,Idade,Prurido genital,Corrimento branco,Placas esbranqui√ßadas orais,Dispareunia,HIV+,Glicemia elevada,Cultura positiva p/ Candida
1,F,26,Sim,Sim,N√£o,Sim,N√£o,N√£o,Sim
2,F,34,Sim,Sim,N√£o,N√£o,N√£o,Sim,Sim
3,M,41,N√£o,N√£o,Sim,N√£o,Sim,N√£o,Sim
4,F,29,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
5,F,50,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim
6,F,23,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
7,M,38,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
8,F,45,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim
9,F,32,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
10,M,48,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
11,F,27,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
12,F,52,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim
13,F,36,Sim,Sim,N√£o,N√£o,N√£o,N√£o,Sim
14,M,44,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
15,F,28,Sim,Sim,N√£o,Sim,N√£o,N√£o,Sim
16,F,39,Sim,Sim,N√£o,N√£o,N√£o,Sim,Sim
17,M,42,N√£o,N√£o,Sim,N√£o,Sim,N√£o,Sim
18,F,31,Sim,Sim,N√£o,Sim,N√£o,N√£o,Sim
19,F,47,Sim,Sim,N√£o,N√£o,N√£o,Sim,Sim
20,M,55,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim`,
        info: {
            introduction: `<ul><li><span class="icon">üçÑ</span><strong>Agente Comensal:</strong> A candid√≠ase √© uma infec√ß√£o f√∫ngica causada por leveduras do g√™nero <em>Candida</em>, sendo a <em>Candida albicans</em> a esp√©cie mais comum. Este fungo √© um habitante natural da pele, boca, trato gastrointestinal e genital.</li><li><span class="icon">‚öñÔ∏è</span><strong>Quebra de Equil√≠brio:</strong> A doen√ßa manifesta-se quando ocorre um desequil√≠brio na microbiota local ou uma queda na imunidade do hospedeiro, permitindo que a levedura se prolifere de forma descontrolada e mude de sua forma comensal para uma forma filamentosa invasiva.</li><li><span class="icon">üìà</span><strong>Fatores Predisponentes:</strong> Condi√ß√µes como diabetes mellitus, uso de antibi√≥ticos de amplo espectro, terapia com corticosteroides, gravidez e imunodefici√™ncias (como HIV) s√£o fatores de risco conhecidos.</li></ul>`,
            medicalImportance: `<ul><li><span class="icon">üå°Ô∏è</span><strong>Amplo Espectro de Doen√ßas:</strong> A candid√≠ase pode variar desde infec√ß√µes superficiais e localizadas, como a candid√≠ase oral ("sapinho") e vulvovaginal, que s√£o extremamente comuns, at√© formas invasivas graves.</li><li><span class="icon">ü©∏</span><strong>Candid√≠ase Invasiva:</strong> Em pacientes hospitalizados, cr√≠ticos ou imunocomprometidos, a <em>Candida</em> pode entrar na corrente sangu√≠nea (candidemia) e se disseminar para √≥rg√£os vitais como cora√ß√£o, c√©rebro e olhos, resultando em uma condi√ß√£o com alta taxa de mortalidade.</li><li><span class="icon">üè•</span><strong>Infec√ß√£o Hospitalar:</strong> As esp√©cies de <em>Candida</em> s√£o uma causa importante de infec√ß√µes hospitalares, especialmente em unidades de terapia intensiva, associadas ao uso de cateteres venosos centrais e outros procedimentos invasivos.</li></ul>`,
            clinicalPerspective: `<ul><li><span class="icon">üî¨</span><strong>Diagn√≥stico:</strong> Cl√≠nico, confirmado por exame micol√≥gico.</li><li><span class="icon">üíä</span><strong>Tratamento:</strong> Antif√∫ngicos t√≥picos ou sist√™micos.</li><li><span class="icon">üõ°Ô∏è</span><strong>Controle:</strong> Manejo dos fatores de risco √© crucial para prevenir a doen√ßa e suas recorr√™ncias.</li></ul>`
        }
    },
    'Esporotricose': {
        rawData: `Paciente,Sexo,Idade,Profiss√£o/Exposi√ß√£o,Les√£o ulcerada cut√¢nea,Forma linfocut√¢nea,Forma disseminada,Contato com gato,HIV+,Cultura positiva p/ Sporothrix
1,M,45,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
2,F,32,Dona de casa (jardim),Sim,N√£o,N√£o,Sim,N√£o,Sim
3,M,60,Jardineiro,Sim,Sim,N√£o,N√£o,N√£o,Sim
4,F,28,Estudante (gatos),Sim,N√£o,N√£o,Sim,N√£o,Sim
5,M,54,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
6,F,37,Professora (gatos),Sim,N√£o,N√£o,Sim,N√£o,Sim
7,M,42,Pedreiro,Sim,Sim,N√£o,N√£o,N√£o,Sim
8,F,47,Feirante (hortali√ßas),Sim,Sim,N√£o,N√£o,N√£o,Sim
9,M,35,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
10,F,29,Dona de casa (gatos),Sim,N√£o,N√£o,Sim,N√£o,Sim
11,M,62,Aposentado (horta),Sim,Sim,N√£o,N√£o,N√£o,Sim
12,F,41,Veterin√°ria,Sim,N√£o,N√£o,Sim,N√£o,Sim
13,M,56,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
14,F,39,Comerciante (gatos),Sim,N√£o,N√£o,Sim,N√£o,Sim
15,M,48,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
16,F,44,Dona de casa (jardim),Sim,N√£o,N√£o,Sim,N√£o,Sim
17,M,51,Agricultor,Sim,Sim,N√£o,N√£o,N√£o,Sim
18,F,33,Estudante (gatos),Sim,N√£o,N√£o,Sim,N√£o,Sim
19,M,65,Aposentado (horta),Sim,Sim,N√£o,N√£o,N√£o,Sim
20,M,40,HIV+,Sim,Sim,Sim,N√£o,Sim,Sim`,
        info: {
            introduction: `<ul><li><span class="icon">üçÑ</span><strong>Fungo Dim√≥rfico:</strong> A esporotricose √© uma micose causada pelo fungo dim√≥rfico do complexo <em>Sporothrix schenckii</em>. Ele existe como mofo no ambiente (solo, plantas) e como levedura nos tecidos de hospedeiros de sangue quente.</li><li><span class="icon">ü©π</span><strong>Via de Infec√ß√£o:</strong> A transmiss√£o cl√°ssica ocorre por inocula√ß√£o traum√°tica do fungo na pele, atrav√©s de arranh√µes ou perfura√ß√µes com espinhos, farpas ou vegeta√ß√£o contaminada (a "doen√ßa do jardineiro").</li><li><span class="icon">üêæ</span><strong>Transmiss√£o Zoon√≥tica:</strong> No Brasil, a doen√ßa emergiu como uma importante zoonose, sendo a transmiss√£o por arranh√µes e mordidas de gatos infectados a principal via de infec√ß√£o humana e animal.</li></ul>`,
            medicalImportance: `<ul><li><span class="icon">üìà</span><strong>Zoonose Emergente:</strong> O Brasil enfrenta a maior epidemia de esporotricose transmitida por gatos j√° registrada no mundo, transformando uma doen√ßa rural em um grave problema de sa√∫de p√∫blica urbana.</li><li><span class="icon">üå°Ô∏è</span><strong>Forma Linfocut√¢nea:</strong> A apresenta√ß√£o cl√≠nica mais comum √© a forma linfocut√¢nea, caracterizada por uma les√£o inicial no local da inocula√ß√£o que se dissemina ao longo dos vasos linf√°ticos, formando n√≥dulos secund√°rios.</li><li><span class="icon">‚ö†Ô∏è</span><strong>Risco em Imunocomprometidos:</strong> Embora rara, a forma disseminada pode ocorrer, especialmente em pacientes com imunodefici√™ncia (como HIV/AIDS), afetando m√∫ltiplos √≥rg√£os e apresentando alta morbimortalidade.</li></ul>`,
            clinicalPerspective: `<ul><li><span class="icon">üî¨</span><strong>Diagn√≥stico:</strong> Isolamento do fungo em cultura √© o padr√£o-ouro.</li><li><span class="icon">üíä</span><strong>Tratamento:</strong> Itraconazol √© a primeira escolha.</li><li><span class="icon">üåç</span><strong>Sa√∫de √önica:</strong> O controle exige uma abordagem integrada (sa√∫de humana, animal e ambiental).</li></ul>`
        }
    },
    'Histoplasmose': {
        rawData: `Paciente,Sexo,Idade,Exposi√ß√£o (aves/morcegos),Tosse cr√¥nica,Febre,Perda de peso,Les√µes cut√¢neas,Dispneia,HIV+,Rx t√≥rax (infiltrado/adenopatia),Sorologia positiva,Cultura positiva
1,M,48,Sim,Sim,Sim,Sim,N√£o,Sim,Sim,Sim,Sim,Sim
2,F,35,Sim,Sim,Sim,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
3,M,52,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
4,F,29,N√£o,Sim,Sim,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
5,M,60,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
6,F,33,Sim,Sim,Sim,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
7,M,41,Sim,Sim,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim,Sim
8,F,55,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
9,M,38,N√£o,Sim,Sim,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
10,F,44,Sim,Sim,Sim,Sim,N√£o,Sim,Sim,Sim,Sim,Sim
11,M,47,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
12,F,32,N√£o,Sim,N√£o,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
13,M,53,Sim,Sim,Sim,Sim,N√£o,Sim,Sim,Sim,Sim,Sim
14,F,39,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
15,M,46,Sim,Sim,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim,Sim
16,F,28,N√£o,Sim,Sim,N√£o,N√£o,Sim,N√£o,Sim,Sim,Sim
17,M,50,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
18,F,42,Sim,Sim,Sim,Sim,N√£o,Sim,N√£o,Sim,Sim,Sim
19,M,61,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim
20,M,36,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim,Sim`,
        info: {
            introduction: `<ul><li><span class="icon">üçÑ</span><strong>Fungo de Ambiente:</strong> A histoplasmose √© uma micose sist√™mica causada pelo fungo dim√≥rfico <em>Histoplasma capsulatum</em>.</li><li><span class="icon">ü¶á</span><strong>Habitat Caracter√≠stico:</strong> O fungo se desenvolve no solo, especialmente em locais ricos em excrementos de aves e morcegos, como cavernas, galinheiros, e s√≥t√£os de pr√©dios antigos.</li><li><span class="icon">üå¨Ô∏è</span><strong>Transmiss√£o por Inala√ß√£o:</strong> A infec√ß√£o ocorre pela inala√ß√£o dos microcon√≠dios (esporos) do fungo, que se convertem em leveduras nos pulm√µes ap√≥s serem fagocitados por macr√≥fagos.</li></ul>`,
            medicalImportance: `<ul><li><span class="icon">üåç</span><strong>Micose End√™mica:</strong> √â uma das micoses sist√™micas end√™micas mais comuns em certas regi√µes das Am√©ricas, incluindo o vale dos rios Ohio e Mississippi nos EUA e partes da Am√©rica Latina.</li><li><span class="icon"> asymptomatic</span><strong>Infec√ß√£o Assintom√°tica:</strong> A grande maioria (mais de 90%) das infec√ß√µes em indiv√≠duos imunocompetentes √© assintom√°tica ou causa apenas uma s√≠ndrome gripal leve e autolimitada.</li><li><span class="icon">‚ö†Ô∏è</span><strong>Doen√ßa Grave em Imunocomprometidos:</strong> Em pacientes com imunidade celular deficiente, principalmente aqueles com AIDS em est√°gio avan√ßado, a histoplasmose pode se manifestar como uma doen√ßa disseminada progressiva, que √© grave e frequentemente fatal se n√£o diagnosticada e tratada a tempo.</li></ul>`,
            clinicalPerspective: `<ul><li><span class="icon">üî¨</span><strong>Diagn√≥stico:</strong> Requer alta suspeita cl√≠nica e √© confirmado por cultura, sorologia ou detec√ß√£o de ant√≠geno.</li><li><span class="icon">üíä</span><strong>Tratamento:</strong> Formas moderadas a graves requerem tratamento com Itraconazol ou Anfotericina B.</li><li><span class="icon">üõ°Ô∏è</span><strong>Preven√ß√£o:</strong> Evitar a exposi√ß√£o em √°reas de alto risco, especialmente para imunocomprometidos.</li></ul>`
        }
    },
    'Pitir√≠ase Versicolor': {
        rawData: `Paciente,Sexo,Idade,Fototipo de pele,M√°culas hipopigmentadas,M√°culas hipercromicas,Descama√ß√£o fina,Prurido leve,Sudorese excessiva,Exame direto positivo ( Malassezia )
1,M,22,III,Sim,N√£o,Sim,Sim,Sim,Sim
2,F,28,II,Sim,Sim,Sim,N√£o,Sim,Sim
3,M,19,IV,Sim,N√£o,Sim,N√£o,Sim,Sim
4,F,34,III,Sim,N√£o,Sim,Sim,Sim,Sim
5,M,25,V,N√£o,Sim,Sim,N√£o,Sim,Sim
6,F,30,II,Sim,N√£o,Sim,Sim,Sim,Sim
7,M,21,III,Sim,N√£o,Sim,N√£o,Sim,Sim
8,F,27,IV,Sim,Sim,Sim,Sim,Sim,Sim
9,M,23,II,Sim,N√£o,Sim,N√£o,Sim,Sim
10,F,29,III,Sim,N√£o,Sim,Sim,N√£o,Sim
11,M,26,IV,Sim,Sim,Sim,N√£o,Sim,Sim
12,F,31,V,N√£o,Sim,Sim,Sim,Sim,Sim
13,M,20,II,Sim,N√£o,Sim,Sim,Sim,Sim
14,F,33,III,Sim,Sim,Sim,N√£o,Sim,Sim
15,M,18,IV,Sim,N√£o,Sim,Sim,Sim,Sim
16,F,36,II,Sim,N√£o,Sim,N√£o,N√£o,Sim
17,M,24,III,Sim,N√£o,Sim,Sim,Sim,Sim
18,F,40,IV,N√£o,Sim,Sim,N√£o,Sim,Sim
19,M,22,II,Sim,N√£o,Sim,Sim,Sim,Sim
20,F,35,III,Sim,Sim,Sim,N√£o,Sim,Sim`,
        info: {
            introduction: `<ul><li><span class="icon">üçÑ</span><strong>Fungo da Pele:</strong> √â uma micose superficial benigna causada por leveduras lipof√≠licas do g√™nero <em>Malassezia</em> (principalmente <em>M. furfur</em>).</li><li><span class="icon">ü§ù</span><strong>Flora Residente:</strong> Essas leveduras s√£o componentes normais da microbiota da pele humana, especialmente em √°reas ricas em gl√¢ndulas seb√°ceas, como o tronco superior e o pesco√ßo.</li><li><span class="icon">‚òÄÔ∏è</span><strong>Fatores Desencadeantes:</strong> A doen√ßa ocorre quando o fungo passa de sua forma de levedura comensal para uma forma filamentosa patog√™nica. Fatores como calor, umidade, sudorese e oleosidade da pele favorecem essa transi√ß√£o.</li></ul>`,
            medicalImportance: `<ul><li><span class="icon">üé®</span><strong>Manifesta√ß√£o Cl√≠nica:</strong> Caracteriza-se por m√°culas (manchas) que podem ser mais claras (hipocr√¥micas) ou mais escuras (hipercr√¥micas) que a pele normal, com uma descama√ß√£o fina. A altera√ß√£o da cor ocorre devido √† produ√ß√£o de √°cido azelaico pelo fungo, que interfere na produ√ß√£o de melanina.</li><li><span class="icon">üåç</span><strong>Dermatose Universal:</strong> √â uma das dermatoses mais comuns em todo o mundo, afetando pessoas de todas as idades, mas √© mais prevalente em adolescentes e adultos jovens em climas quentes e √∫midos.</li><li><span class="icon">‚ú®</span><strong>Impacto Est√©tico:</strong> Embora seja uma condi√ß√£o sem gravidade e n√£o contagiosa, o principal impacto √© est√©tico, o que pode causar desconforto e preocupa√ß√£o para o paciente, levando-o a procurar tratamento. A recorr√™ncia √© muito comum.</li></ul>`,
            clinicalPerspective: `<ul><li><span class="icon">üî¨</span><strong>Diagn√≥stico:</strong> Geralmente cl√≠nico, confirmado por exame micol√≥gico direto.</li><li><span class="icon">üíä</span><strong>Tratamento:</strong> T√≥pico na maioria dos casos.</li><li><span class="icon">üîÑ</span><strong>Recorr√™ncia:</strong> √â comum, pois o fungo √© um habitante normal da pele.</li></ul>`
        }
    }
};

function parseCSV(csvText) {
    const lines = csvText.trim().split('\n');
    const headers = lines[0].split(',').map(h => h.trim());
    return lines.slice(1).map(line => {
        const values = line.split(',');
        const obj = {};
        headers.forEach((header, i) => {
            obj[header] = values[i] ? values[i].trim() : '';
        });
        return obj;
    });
}

function analyzeData(parsedData) {
    const analysis = {};
    if (!parsedData || parsedData.length === 0) return analysis;
    const headers = Object.keys(parsedData[0]);
    headers.forEach(header => {
        const lowerHeader = header.toLowerCase();
        if (lowerHeader === 'paciente' || lowerHeader === 'idade' || lowerHeader.includes('profiss√£o') || lowerHeader.includes('fototipo')) return;
        
        const counts = parsedData.reduce((acc, row) => {
            const value = row[header] || 'N/A';
            acc[value] = (acc[value] || 0) + 1;
            return acc;
        }, {});
        analysis[header] = counts;
    });
    return analysis;
}

function updateUI() {
    const steps = document.querySelectorAll('.step-card');
    steps.forEach((step, index) => {
        step.classList.toggle('hidden', index + 1 !== state.currentStep);
    });

    const progressBar = document.getElementById('progressBar');
    const stepIndicator = document.getElementById('step-indicator');
    const totalSteps = steps.length;
    const progress = (state.currentStep / totalSteps) * 100;
    progressBar.style.width = `${progress}%`;
    stepIndicator.textContent = `Passo ${state.currentStep} de ${totalSteps}`;

    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const generateBtn = document.getElementById('generate-btn');

    prevBtn.disabled = state.currentStep === 1;
    nextBtn.classList.toggle('hidden', state.currentStep === totalSteps);
    generateBtn.classList.toggle('hidden', state.currentStep !== totalSteps);

    validateStep();
}

function validateStep() {
    const nextBtn = document.getElementById('next-btn');
    const generateBtn = document.getElementById('generate-btn');
    let isValid = false;

    switch (state.currentStep) {
        case 1:
            isValid = !!state.selectedInfection;
            break;
        case 2:
            isValid = true;
            break;
        case 3:
            const obs = document.getElementById('observations').value;
            const conc = document.getElementById('conclusion').value;
            isValid = obs.trim() !== '' && conc.trim() !== '';
            break;
        case 4:
            const authors = document.getElementById('authors').value;
            isValid = authors.trim() !== '' && !!state.presentation.layout;
            break;
    }
    nextBtn.disabled = !isValid;
    generateBtn.disabled = !isValid;
}

function renderStep1() {
    const list = document.getElementById('infection-list');
    list.innerHTML = '';
    Object.keys(infectionData).forEach(name => {
        const button = document.createElement('button');
        button.className = `p-4 rounded-lg text-center cursor-pointer infection-btn ${state.selectedInfection === name ? 'selected' : ''}`;
        button.textContent = name;
        button.onclick = () => {
            state.selectedInfection = name;
            renderStep1();
            validateStep();
        };
        list.appendChild(button);
    });
}

function renderStep2() {
    const headers = infectionData[state.selectedInfection].rawData.split('\n')[0].split(',');
    const tableHead = document.querySelector('#data-table thead');
    const tableBody = document.querySelector('#data-table tbody');
    tableHead.innerHTML = '';
    tableBody.innerHTML = '';

    const trHead = document.createElement('tr');
    headers.forEach(h => {
        const th = document.createElement('th');
        th.textContent = h.trim();
        th.className = 'p-2';
        trHead.appendChild(th);
    });
    tableHead.appendChild(trHead);

    for (let i = 0; i < 20; i++) {
        const trBody = document.createElement('tr');
        trBody.className = 'border-b border-gray-700 hover:bg-gray-700/50';
        headers.forEach(() => {
            const td = document.createElement('td');
            td.className = 'data-input-cell';
            td.setAttribute('contenteditable', 'true');
            trBody.appendChild(td);
        });
        tableBody.appendChild(trBody);
    }
}

function renderStep3() {
    const parsed = parseCSV(infectionData[state.selectedInfection].rawData);
    const analysis = analyzeData(parsed);
    state.data.analysis = analysis;
    state.data.total = parsed.length;

    const buttonsContainer = document.getElementById('variable-buttons');
    buttonsContainer.innerHTML = '';
    
    Object.keys(analysis).forEach((variable, index) => {
        const button = document.createElement('button');
        button.textContent = variable;
        button.dataset.variable = variable;
        button.className = `variable-btn w-full text-left p-3 rounded-md bg-gray-700 hover:bg-gray-600 text-white`;
        if (index === 0) button.classList.add('active');
        buttonsContainer.appendChild(button);
    });

    buttonsContainer.addEventListener('click', (e) => {
        if (e.target && e.target.matches('button.variable-btn')) {
            const variableName = e.target.dataset.variable;
            document.querySelectorAll('.variable-btn').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            renderVariableChart(variableName);
        }
    });

    renderVariableChart(Object.keys(analysis)[0]);
    document.getElementById('observations').addEventListener('input', validateStep);
    document.getElementById('conclusion').addEventListener('input', validateStep);
}

function getChartConfig(variableName, variableData) {
    const chartTypes = ['pie', 'bar', 'bar'];
    const currentChartType = chartTypes[state.chartTypeIndex % chartTypes.length];
    state.chartTypeIndex++;

    const labels = Object.keys(variableData);
    const data = Object.values(variableData);
    const colors = {
        pie: ['rgba(78, 205, 196, 0.8)', 'rgba(247, 184, 1, 0.8)', 'rgba(255, 107, 107, 0.8)', 'rgba(130, 88, 226, 0.8)'],
        bar: 'rgba(78, 205, 196, 0.6)',
        barBorder: 'rgba(78, 205, 196, 1)'
    };
    
    const baseOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: currentChartType === 'pie', labels: { color: '#FFFFFF' } },
            title: { display: true, text: variableName, color: '#FFFFFF', font: { size: 18 } }
        }
    };

    if (currentChartType === 'pie') {
        return {
            type: 'pie',
            data: {
                labels: labels,
                datasets: [{ data: data, backgroundColor: colors.pie, borderColor: '#2d3748', borderWidth: 2 }]
            },
            options: baseOptions
        };
    } else {
        const isHorizontal = state.chartTypeIndex % 2 === 0;
        return {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: colors.bar,
                    borderColor: colors.barBorder,
                    borderWidth: 1,
                    borderRadius: 4
                }]
            },
            options: {
                ...baseOptions,
                indexAxis: isHorizontal ? 'y' : 'x',
                 plugins: { ...baseOptions.plugins, legend: { display: false } },
                scales: {
                    x: { ticks: { color: '#9CA3AF' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                    y: { ticks: { color: '#9CA3AF' }, grid: { display: isHorizontal ? false : true, color: 'rgba(255, 255, 255, 0.1)' } }
                }
            }
        };
    }
}

function renderVariableChart(variableName) {
    const variableData = state.data.analysis[variableName];
    const ctx = document.getElementById('variableChart').getContext('2d');
    
    if (state.charts.variableChart) {
        state.charts.variableChart.destroy();
    }
    const chartConfig = getChartConfig(variableName, variableData);
    state.charts.variableChart = new Chart(ctx, chartConfig);
}

function renderStep4() {
    const layouts = {
        'teal': { name: '√Ågua-marinha', class: 'bg-gradient-to-br from-teal-400 to-cyan-600' },
        'amber': { name: 'Dourado', class: 'bg-gradient-to-br from-amber-400 to-orange-600' },
        'indigo': { name: 'Violeta', class: 'bg-gradient-to-br from-indigo-400 to-purple-600' },
        'rose': { name: 'Magenta', class: 'bg-gradient-to-br from-rose-400 to-pink-600' }
    };
    const container = document.getElementById('layout-options');
    container.innerHTML = '';
    
    for (const key in layouts) {
        const layout = layouts[key];
        const button = document.createElement('button');
        button.dataset.layoutKey = key;
        button.innerHTML = `<div class="w-10 h-10 rounded-full ${layout.class} mb-1 shadow-lg pointer-events-none"></div><span class="text-xs text-gray-300 pointer-events-none">${layout.name}</span>`;
        button.className = `flex flex-col items-center p-2 border-2 rounded-lg transition-colors ${state.presentation.layout === key ? 'border-cyan-400' : 'border-transparent'}`;
        button.onclick = () => {
            state.presentation.layout = key;
            container.querySelectorAll('button').forEach(btn => {
                btn.classList.toggle('border-cyan-400', btn.dataset.layoutKey === key);
                btn.classList.toggle('border-transparent', btn.dataset.layoutKey !== key);
            });
            validateStep();
        };
        container.appendChild(button);
    }
    
    document.getElementById('authors').addEventListener('input', (e) => {
        state.presentation.authors = e.target.value;
        validateStep();
    });
    validateStep();
}

async function generateAllChartImages() {
    const chartImages = [];
    const variables = Object.keys(state.data.analysis);
    let tempChartIndex = 0; 

    for (const variable of variables) {
        const originalIndex = state.chartTypeIndex;
        state.chartTypeIndex = tempChartIndex;
        
        const variableData = state.data.analysis[variable];
        const offscreenCanvas = document.createElement('canvas');
        offscreenCanvas.width = 500;
        offscreenCanvas.height = 400;

        let config = getChartConfig(variable, variableData);
        config.options.animation = { duration: 0 };
        config.options.responsive = false;
        config.options.maintainAspectRatio = false;

        const chart = new Chart(offscreenCanvas.getContext('2d'), config);
        
        await new Promise(resolve => setTimeout(resolve, 100)); 

        chartImages.push({
            title: variable,
            image: chart.toBase64Image()
        });
        chart.destroy();

        tempChartIndex++;
        state.chartTypeIndex = originalIndex;
    }
    return chartImages;
}

async function generatePresentation() {
    const { selectedInfection, analysis, presentation } = state;
    const info = infectionData[selectedInfection].info;
    
    document.getElementById('generate-btn').textContent = 'Gerando...';
    document.getElementById('generate-btn').disabled = true;

    const chartImages = await generateAllChartImages();

    const colorSchemes = {
        teal: { primary: '#0D7377', secondary: '#4ECDC4', accent: '#F7B801', text: '#F7FFF7', textDark: '#1A535C' },
        amber: { primary: '#B45309', secondary: '#F59E0B', accent: '#65A30D', text: '#FFFBEB', textDark: '#78350F' },
        indigo: { primary: '#312E81', secondary: '#6366F1', accent: '#EC4899', text: '#EEF2FF', textDark: '#3730A3' },
        rose: { primary: '#881337', secondary: '#F43F5E', accent: '#0891B2', text: '#FFF1F2', textDark: '#9F1239' }
    };
    const theme = colorSchemes[presentation.layout];

    const icons = {
        introduction: 'üìñ', medicalImportance: '‚öïÔ∏è', data: 'üìä',
        observations: 'üí°', conclusion: 'üìå', perspective: 'üî≠', thanks: 'üôè'
    };
    
    // Helper para criar cards para observa√ß√µes e conclus√£o
    const renderTopicsInCards = (text) => {
        const topics = text.split('\n').filter(t => t.trim() !== '');
        if (topics.length === 0) return '<blockquote>Nenhuma informa√ß√£o fornecida.</blockquote>';

        let html = '';
        for (let i = 0; i < topics.length; i += 3) {
            const chunk = topics.slice(i, i + 3);
            const listItems = chunk.map(item => `<li><span class="icon">üîπ</span>${item}</li>`).join('');
            html += `<div class="topic-card"><ul>${listItems}</ul></div>`;
        }
        return `<div class="topics-container">${html}</div>`;
    };

    const observationsHTML = renderTopicsInCards(analysis.observations);
    const conclusionHTML = renderTopicsInCards(analysis.conclusion);

    const chartsHTML = chartImages.map(chart => `
        <div>
            <h4 style="margin: 0 0 10px 0; font-size: 1.1em; color: ${theme.secondary}; text-align: center; font-family: 'Poppins', sans-serif;">${chart.title}</h4>
            <img src="${chart.image}" alt="Gr√°fico de ${chart.title}" style="max-width: 100%; height: auto; border-radius: 4px; background: rgba(0,0,0,0.15); padding: 5px;">
        </div>`).join('');

    const slidesHTML = `
        <!DOCTYPE html><html lang="pt-BR"><head><meta charset="UTF-8"><title>Apresenta√ß√£o: ${selectedInfection}</title>
        <link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
        <style>
            :root { --p: ${theme.primary}; --s: ${theme.secondary}; --a: ${theme.accent}; --t: ${theme.text}; }
            body { 
                font-family: 'Lato', sans-serif; 
                background-color: var(--p);
                background-image: linear-gradient(160deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.05) 40%, rgba(0,0,0,0.05) 60%, rgba(0,0,0,0.3) 100%), linear-gradient(to top, rgba(255,255,255,0.2), transparent 50%);
                color: var(--t); 
                margin: 0; 
                overflow: hidden; 
            }
            .slide { box-sizing: border-box; display: none; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 40px 60px; height: 100vh; width: 100%; position: absolute; top: 0; left: 0; opacity: 0; transform: scale(0.95); visibility: hidden; transition: opacity 0.6s ease, transform 0.6s ease, visibility 0.6s; }
            .slide.active { display: flex; opacity: 1; transform: scale(1); visibility: visible; }
            .slide-content { max-width: 1200px; width: 100%; animation: fadeIn 1s ease-out 0.3s both; }
            header { position: absolute; top: 20px; left: 20px; right: 20px; font-size: 1.6em; text-align: left; border-bottom: 1px solid var(--s); padding-bottom: 10px; opacity: 0.7; }
            header p { margin: 2px 0; color: var(--t); line-height: 1.2; }
            footer { position: absolute; bottom: 20px; right: 20px; font-size: 0.9em; color: var(--t); opacity: 0.7; }
            h1 { font-family: 'Poppins', sans-serif; font-size: clamp(3.8rem, 8vw, 6rem); letter-spacing: -1px; font-weight: 800; color: white; text-shadow: 2px 2px 15px rgba(0,0,0,0.3); margin: 0; }
            h2 { font-family: 'Poppins', sans-serif; font-size: clamp(2rem, 3.5vw, 2.8rem); color: white; border-bottom: 3px solid var(--s); padding-bottom: 12px; margin-bottom: 25px; font-weight: 700; display: inline-flex; align-items: center; gap: 15px; }
            h3 { font-family: 'Poppins', sans-serif; font-size: 1.5em; color: var(--s); margin-bottom: 25px; font-weight: 600; }
            ul { list-style: none; padding: 0; text-align: left; max-width: 900px; margin: 0 auto;}
            ul li { display: flex; align-items: flex-start; font-size: clamp(1.25rem, 2.2vw, 1.5rem); line-height: 1.7; color: #e2e8f0; margin-bottom: 15px; }
            ul li strong { color: var(--s); }
            ul li .icon { margin-right: 12px; font-size: 1.1em; line-height: 1.6; }
            .topics-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; width: 100%; }
            .topic-card { background: rgba(0,0,0,0.2); border-radius: 12px; padding: 20px 25px; text-align: left; flex: 1 1 300px; max-width: 450px; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1); }
            .topic-card ul { padding-left: 0; }
            .topic-card li { font-size: clamp(1.1rem, 1.8vw, 1.3rem); line-height: 1.6; color: #e2e8f0; margin-bottom: 10px; }
            .nav-btn { position: fixed; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 10px; font-size: 24px; cursor: pointer; z-index: 100; border-radius: 50%; width: 50px; height: 50px; backdrop-filter: blur(5px); transition: all 0.2s ease; }
            .nav-btn:hover { background: rgba(255,255,255,0.2); transform: translateY(-50%) scale(1.1); }
            #prevSlide { left: 20px; }
            #nextSlide { right: 20px; }
            .grid-charts { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; width: 100%; max-height: 70vh; overflow-y: auto; padding: 10px; }
            @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        </style></head><body>
            <div id="slide-container">
                <section class="slide active"><header><p>Centro Universit√°rio de Jo√£o Pessoa - UNIP√ä</p><p>Mecanismos de Agress√£o, Patol√≥gicos e de Defesa - 2 | Prof. Rodrigo Niskier</p></header><div class="slide-content"><h3>An√°lise Epidemiol√≥gica de</h3><h1>${selectedInfection}</h1><p style="text-align: center; margin-top: 50px; color: var(--s); font-family: 'Poppins', sans-serif;"><strong>Respons√°veis:</strong> ${presentation.authors}</p></div><footer>Slide 1 / 8</footer></section>
                <section class="slide"><div class="slide-content"><h2>${icons.introduction} Introdu√ß√£o</h2>${info.introduction}</div><footer>Slide 2 / 8</footer></section>
                <section class="slide"><div class="slide-content"><h2>${icons.medicalImportance} Import√¢ncia M√©dica</h2>${info.medicalImportance}</div><footer>Slide 3 / 8</footer></section>
                <section class="slide"><div class="slide-content"><h2>${icons.data} Dados Analisados</h2><div class="grid-charts">${chartsHTML}</div></div><footer>Slide 4 / 8</footer></section>
                <section class="slide"><div class="slide-content"><h2>${icons.observations} Observa√ß√µes</h2>${observationsHTML}</div><footer>Slide 5 / 8</footer></section>
                <section class="slide"><div class="slide-content"><h2>${icons.conclusion} Conclus√£o</h2>${conclusionHTML}</div><footer>Slide 6 / 8</footer></section>
                <section class="slide"><div class="slide-content"><h2>${icons.perspective} Perspectivas</h2>${info.clinicalPerspective}</div><footer>Slide 7 / 8</footer></section>
                <section class="slide"><div class="slide-content"><h3>Agradecimentos</h3><h1>${icons.thanks} Obrigado!</h1></div><footer>Slide 8 / 8</footer></section>
            </div>
            <button id="prevSlide" class="nav-btn">&lt;</button><button id="nextSlide" class="nav-btn">&gt;</button>
            <script>
                let current = 0; const slides = document.querySelectorAll('.slide'); const total = slides.length;
                const show = (index) => { slides.forEach((s, i) => s.classList.toggle('active', i === index)); };
                document.getElementById('nextSlide').addEventListener('click', () => { current = (current + 1) % total; show(current); });
                document.getElementById('prevSlide').addEventListener('click', () => { current = (current - 1 + total) % total; show(current); });
                document.addEventListener('keydown', (e) => { if (e.key === 'ArrowRight') document.getElementById('nextSlide').click(); if (e.key === 'ArrowLeft') document.getElementById('prevSlide').click(); });
                show(0);
            <\/script>
        </body></html>`;

    const presentationWindow = window.open('', '_blank');
    presentationWindow.document.write(slidesHTML);
    presentationWindow.document.close();
    
    document.getElementById('generate-btn').textContent = 'Gerar Apresenta√ß√£o';
    document.getElementById('generate-btn').disabled = false;
}

// Inicializa√ß√£o e Event Listeners
document.addEventListener('DOMContentLoaded', () => {
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const generateBtn = document.getElementById('generate-btn');

    nextBtn.addEventListener('click', () => {
        if (state.currentStep < 4) {
            state.currentStep++;
            if (state.currentStep === 2) renderStep2();
            if (state.currentStep === 3) { state.chartTypeIndex = 0; renderStep3(); }
            if (state.currentStep === 4) renderStep4();
            updateUI();
        }
    });

    prevBtn.addEventListener('click', () => {
        if (state.currentStep > 1) { state.currentStep--; updateUI(); }
    });
    
    document.getElementById('observations').addEventListener('input', (e) => { state.analysis.observations = e.target.value; validateStep(); });
    document.getElementById('conclusion').addEventListener('input', (e) => { state.analysis.conclusion = e.target.value; validateStep(); });

    generateBtn.addEventListener('click', () => { if (!generateBtn.disabled) { generatePresentation(); } });

    renderStep1();
    updateUI();
});
</script>
</body>
</html>

